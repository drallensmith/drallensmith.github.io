
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>genome &#8212; NEAT-Python 0.92 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.92',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for genome</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Handles genomes (individuals in the population).&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>


<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">count</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="n">choice</span><span class="p">,</span> <span class="n">random</span><span class="p">,</span> <span class="n">shuffle</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">neat.activations</span> <span class="k">import</span> <span class="n">ActivationFunctionSet</span>
<span class="kn">from</span> <span class="nn">neat.aggregations</span> <span class="k">import</span> <span class="n">AggregationFunctionSet</span>
<span class="kn">from</span> <span class="nn">neat.config</span> <span class="k">import</span> <span class="n">ConfigParameter</span><span class="p">,</span> <span class="n">write_pretty_params</span>
<span class="kn">from</span> <span class="nn">neat.genes</span> <span class="k">import</span> <span class="n">DefaultConnectionGene</span><span class="p">,</span> <span class="n">DefaultNodeGene</span>
<span class="kn">from</span> <span class="nn">neat.graphs</span> <span class="k">import</span> <span class="n">creates_cycle</span>
<span class="kn">from</span> <span class="nn">neat.multiparameter</span> <span class="k">import</span> <span class="n">MultiParameterSet</span>
<span class="kn">from</span> <span class="nn">neat.six_util</span> <span class="k">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">iterkeys</span>


<div class="viewcode-block" id="DefaultGenomeConfig"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenomeConfig">[docs]</a><span class="k">class</span> <span class="nc">DefaultGenomeConfig</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets up and holds configuration information for the DefaultGenome class.&quot;&quot;&quot;</span>
    <span class="n">allowed_connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;unconnected&#39;</span><span class="p">,</span> <span class="s1">&#39;fs_neat_nohidden&#39;</span><span class="p">,</span> <span class="s1">&#39;fs_neat&#39;</span><span class="p">,</span> <span class="s1">&#39;fs_neat_hidden&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;full_nodirect&#39;</span><span class="p">,</span> <span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="s1">&#39;full_direct&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;partial_nodirect&#39;</span><span class="p">,</span> <span class="s1">&#39;partial&#39;</span><span class="p">,</span> <span class="s1">&#39;partial_direct&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="c1"># Enables functions with evolved parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiparameterset</span> <span class="o">=</span> <span class="n">MultiParameterSet</span><span class="p">(</span><span class="s1">&#39;activation&#39;</span><span class="p">,</span> <span class="s1">&#39;aggregation&#39;</span><span class="p">)</span>
        <span class="c1"># Create full set of available activation functions.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation_defs</span> <span class="o">=</span> <span class="n">ActivationFunctionSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiparameterset</span><span class="p">)</span>
        <span class="c1"># ditto for aggregation functions - name difference for backward compatibility</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_function_defs</span> <span class="o">=</span> <span class="n">AggregationFunctionSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiparameterset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_function_defs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;num_inputs&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;num_outputs&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;num_hidden&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;feed_forward&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;compatibility_disjoint_coefficient&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;compatibility_weight_coefficient&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;conn_add_prob&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;conn_delete_prob&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;node_add_prob&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;node_delete_prob&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;single_structural_mutation&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;structural_mutation_surer&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">),</span>
                        <span class="n">ConfigParameter</span><span class="p">(</span><span class="s1">&#39;initial_connection&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;unconnected&#39;</span><span class="p">)]</span>

        <span class="c1"># Gather configuration data from the gene classes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_gene_type</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;node_gene_type&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_gene_type</span><span class="o">.</span><span class="n">get_config_params</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_gene_type</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;connection_gene_type&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_gene_type</span><span class="o">.</span><span class="n">get_config_params</span><span class="p">()</span>

        <span class="c1"># Use the configuration data to interpret the supplied parameters.</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>

        <span class="c1"># By convention, input pins have negative keys, and the output</span>
        <span class="c1"># pins have keys 0,1,...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_keys</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_inputs</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_outputs</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connection_fraction</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Verify that initial connection type is valid.</span>
        <span class="c1"># pylint: disable=access-member-before-definition</span>
        <span class="k">if</span> <span class="s1">&#39;partial&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_connection</span><span class="p">:</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_connection</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_connection</span> <span class="o">=</span> <span class="n">c</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_fraction</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_fraction</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;&#39;partial&#39; connection value must be between 0.0 and 1.0, inclusive.&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_connection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_connectivity</span>

        <span class="c1"># Verify structural_mutation_surer is valid.</span>
        <span class="c1"># pylint: disable=access-member-before-definition</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;on&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;off&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error_string</span> <span class="o">=</span> <span class="s2">&quot;Invalid structural_mutation_surer </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_string</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">node_indexer</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DefaultGenomeConfig.add_activation"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenomeConfig.add_activation">[docs]</a>    <span class="k">def</span> <span class="nf">add_activation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation_defs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefaultGenomeConfig.add_aggregation"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenomeConfig.add_aggregation">[docs]</a>    <span class="k">def</span> <span class="nf">add_aggregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_function_defs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefaultGenomeConfig.save"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenomeConfig.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;partial&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_connection</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_fraction</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;&#39;partial&#39; connection value must be between 0.0 and 1.0, inclusive.&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;initial_connection      = </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_connection</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">connection_fraction</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;initial_connection      = </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_connection</span><span class="p">))</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_connection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_connectivity</span>

        <span class="n">write_pretty_params</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
                                      <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;initial_connection&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">])</span></div>

<div class="viewcode-block" id="DefaultGenomeConfig.get_new_node_key"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenomeConfig.get_new_node_key">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_node_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_indexer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_indexer</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">iterkeys</span><span class="p">(</span><span class="n">node_dict</span><span class="p">)))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">new_id</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_indexer</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">new_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_dict</span>

        <span class="k">return</span> <span class="n">new_id</span></div>

<div class="viewcode-block" id="DefaultGenomeConfig.check_structural_mutation_surer"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenomeConfig.check_structural_mutation_surer">[docs]</a>    <span class="k">def</span> <span class="nf">check_structural_mutation_surer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_structural_mutation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error_string</span> <span class="o">=</span> <span class="s2">&quot;Invalid structural_mutation_surer </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structural_mutation_surer</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_string</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="DefaultGenome"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome">[docs]</a><span class="k">class</span> <span class="nc">DefaultGenome</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A genome for generalized neural networks.</span>

<span class="sd">    Terminology</span>
<span class="sd">        pin: Point at which the network is conceptually connected to the external world;</span>
<span class="sd">             pins are either input or output.</span>
<span class="sd">        node: Analog of a physical neuron.</span>
<span class="sd">        connection: Connection between a pin/node output and a node&#39;s input, or between a node&#39;s</span>
<span class="sd">             output and a pin/node input.</span>
<span class="sd">        key: Identifier for an object, unique within the set of similar objects.</span>

<span class="sd">    Design assumptions and conventions.</span>
<span class="sd">        1. Each output pin is connected only to the output of its own unique</span>
<span class="sd">           neuron by an implicit connection with weight one. This connection</span>
<span class="sd">           is permanently enabled.</span>
<span class="sd">        2. The output pin&#39;s key is always the same as the key for its</span>
<span class="sd">           associated neuron.</span>
<span class="sd">        3. Output neurons can be modified but not deleted.</span>
<span class="sd">        4. The input values are applied to the input pins unmodified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DefaultGenome.parse_config"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.parse_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">):</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;node_gene_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DefaultNodeGene</span>
        <span class="n">param_dict</span><span class="p">[</span><span class="s1">&#39;connection_gene_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DefaultConnectionGene</span>
        <span class="k">return</span> <span class="n">DefaultGenomeConfig</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefaultGenome.write_config"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.write_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">config</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1"># Unique identifier for a genome instance.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="c1"># (gene_key, gene) pairs for gene sets.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Fitness results.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitness</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="DefaultGenome.configure_new"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.configure_new">[docs]</a>    <span class="k">def</span> <span class="nf">configure_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Configure a new genome based on the given configuration.&quot;&quot;&quot;</span>

        <span class="c1"># Create node genes for the output pins.</span>
        <span class="k">for</span> <span class="n">node_key</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">output_keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">node_key</span><span class="p">)</span>

        <span class="c1"># Add hidden nodes if requested.</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">num_hidden</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">num_hidden</span><span class="p">):</span>
                <span class="n">node_key</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_new_node_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">node_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">node_key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>

        <span class="c1"># Add connections based on initial connectivity type.</span>

        <span class="k">if</span> <span class="s1">&#39;fs_neat&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span> <span class="o">==</span> <span class="s1">&#39;fs_neat_nohidden&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_fs_neat_nohidden</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span> <span class="o">==</span> <span class="s1">&#39;fs_neat_hidden&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_fs_neat_hidden</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">num_hidden</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;Warning: initial_connection = fs_neat will not connect to hidden nodes;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">if this is desired, set initial_connection = fs_neat_nohidden;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">if not, set initial_connection = fs_neat_hidden&quot;</span><span class="p">,</span>
                        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_fs_neat_nohidden</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;full&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span> <span class="o">==</span> <span class="s1">&#39;full_nodirect&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_full_nodirect</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span> <span class="o">==</span> <span class="s1">&#39;full_direct&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_full_direct</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">num_hidden</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;Warning: initial_connection = full with hidden nodes will not do direct input-output connections;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">if this is desired, set initial_connection = full_nodirect;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">if not, set initial_connection = full_direct&quot;</span><span class="p">,</span>
                        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_full_nodirect</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;partial&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span> <span class="o">==</span> <span class="s1">&#39;partial_nodirect&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_partial_nodirect</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">initial_connection</span> <span class="o">==</span> <span class="s1">&#39;partial_direct&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_partial_direct</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">num_hidden</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;Warning: initial_connection = partial with hidden nodes will not do direct input-output connections;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">if this is desired, set initial_connection = partial_nodirect </span><span class="si">{0}</span><span class="s2">;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">config</span><span class="o">.</span><span class="n">connection_fraction</span><span class="p">),</span>
                        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">if not, set initial_connection = partial_direct </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">config</span><span class="o">.</span><span class="n">connection_fraction</span><span class="p">),</span>
                        <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connect_partial_nodirect</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefaultGenome.configure_crossover"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.configure_crossover">[docs]</a>    <span class="k">def</span> <span class="nf">configure_crossover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">genome1</span><span class="p">,</span> <span class="n">genome2</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Configure a new genome by crossover from two parent genomes. &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">genome1</span><span class="o">.</span><span class="n">fitness</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">genome2</span><span class="o">.</span><span class="n">fitness</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">genome1</span><span class="o">.</span><span class="n">fitness</span> <span class="o">&gt;</span> <span class="n">genome2</span><span class="o">.</span><span class="n">fitness</span><span class="p">:</span>
            <span class="n">parent1</span><span class="p">,</span> <span class="n">parent2</span> <span class="o">=</span> <span class="n">genome1</span><span class="p">,</span> <span class="n">genome2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent1</span><span class="p">,</span> <span class="n">parent2</span> <span class="o">=</span> <span class="n">genome2</span><span class="p">,</span> <span class="n">genome1</span>

        <span class="c1"># Inherit connection genes</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">cg1</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">parent1</span><span class="o">.</span><span class="n">connections</span><span class="p">):</span>
            <span class="n">cg2</span> <span class="o">=</span> <span class="n">parent2</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cg2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Excess or disjoint gene: copy from the fittest parent.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cg1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Homologous gene: combine genes from both parents.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cg1</span><span class="o">.</span><span class="n">crossover</span><span class="p">(</span><span class="n">cg2</span><span class="p">)</span>

        <span class="c1"># Inherit node genes</span>
        <span class="n">parent1_set</span> <span class="o">=</span> <span class="n">parent1</span><span class="o">.</span><span class="n">nodes</span>
        <span class="n">parent2_set</span> <span class="o">=</span> <span class="n">parent2</span><span class="o">.</span><span class="n">nodes</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">ng1</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">parent1_set</span><span class="p">):</span>
            <span class="n">ng2</span> <span class="o">=</span> <span class="n">parent2_set</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
            <span class="k">if</span> <span class="n">ng2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Extra gene: copy from the fittest parent</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Homologous gene: combine genes from both parents.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng1</span><span class="o">.</span><span class="n">crossover</span><span class="p">(</span><span class="n">ng2</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefaultGenome.mutate"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.mutate">[docs]</a>    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Mutates this genome. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">single_structural_mutation</span><span class="p">:</span>
            <span class="n">div</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">config</span><span class="o">.</span><span class="n">node_add_prob</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">node_delete_prob</span> <span class="o">+</span>
                         <span class="n">config</span><span class="o">.</span><span class="n">conn_add_prob</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">conn_delete_prob</span><span class="p">))</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">node_add_prob</span><span class="o">/</span><span class="n">div</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_add_node</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">config</span><span class="o">.</span><span class="n">node_add_prob</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">node_delete_prob</span><span class="p">)</span><span class="o">/</span><span class="n">div</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_delete_node</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">config</span><span class="o">.</span><span class="n">node_add_prob</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">node_delete_prob</span> <span class="o">+</span>
                       <span class="n">config</span><span class="o">.</span><span class="n">conn_add_prob</span><span class="p">)</span><span class="o">/</span><span class="n">div</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_add_connection</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">config</span><span class="o">.</span><span class="n">node_add_prob</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">node_delete_prob</span> <span class="o">+</span>
                       <span class="n">config</span><span class="o">.</span><span class="n">conn_add_prob</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">conn_delete_prob</span><span class="p">)</span><span class="o">/</span><span class="n">div</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_delete_connection</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">node_add_prob</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_add_node</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">node_delete_prob</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_delete_node</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">conn_add_prob</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_add_connection</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">conn_delete_prob</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_delete_connection</span><span class="p">()</span>

        <span class="c1"># Mutate connection genes.</span>
        <span class="k">for</span> <span class="n">cg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">cg</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="c1"># Mutate node genes (bias, response, etc.).</span>
        <span class="k">for</span> <span class="n">ng</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">ng</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefaultGenome.mutate_add_node"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.mutate_add_node">[docs]</a>    <span class="k">def</span> <span class="nf">mutate_add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">check_structural_mutation_surer</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutate_add_connection</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Choose a random connection to split</span>
        <span class="n">conn_to_split</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">new_node_id</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_new_node_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">ng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">new_node_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ng</span>

        <span class="c1"># Disable this connection and create two new connections joining its nodes via</span>
        <span class="c1"># the given node.  The new node+connections have roughly the same behavior as</span>
        <span class="c1"># the original connection (depending on the activation function of the new node).</span>
        <span class="n">conn_to_split</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="n">conn_to_split</span><span class="o">.</span><span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">new_node_id</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">new_node_id</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">conn_to_split</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="DefaultGenome.add_connection"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.add_connection">[docs]</a>    <span class="k">def</span> <span class="nf">add_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">input_key</span><span class="p">,</span> <span class="n">output_key</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="c1"># TODO: Add further validation of this connection addition?</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_key</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">output_key</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enabled</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_key</span><span class="p">,</span> <span class="n">output_key</span><span class="p">)</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">connection_gene_type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">init_attributes</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="DefaultGenome.mutate_add_connection"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.mutate_add_connection">[docs]</a>    <span class="k">def</span> <span class="nf">mutate_add_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to add a new connection, the only restriction being that the output</span>
<span class="sd">        node cannot be one of the network input pins.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">possible_outputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
        <span class="n">out_node</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">possible_outputs</span><span class="p">)</span>

        <span class="n">possible_inputs</span> <span class="o">=</span> <span class="n">possible_outputs</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="n">input_keys</span>
        <span class="n">in_node</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">possible_inputs</span><span class="p">)</span>

        <span class="c1"># Don&#39;t duplicate connections.</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_node</span><span class="p">,</span> <span class="n">out_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
            <span class="c1"># TODO: Should this be using mutation to/from rates? Hairy to configure...</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">check_structural_mutation_surer</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="c1"># Don&#39;t allow connections between two output nodes</span>
        <span class="k">if</span> <span class="n">in_node</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">output_keys</span> <span class="ow">and</span> <span class="n">out_node</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">output_keys</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># No need to check for connections between input nodes:</span>
        <span class="c1"># they cannot be the output end of a connection (see above).</span>

        <span class="c1"># For feed-forward networks, avoid creating cycles.</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">feed_forward</span> <span class="ow">and</span> <span class="n">creates_cycle</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">)),</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">in_node</span><span class="p">,</span> <span class="n">out_node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">cg</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cg</span></div>

<div class="viewcode-block" id="DefaultGenome.mutate_delete_node"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.mutate_delete_node">[docs]</a>    <span class="k">def</span> <span class="nf">mutate_delete_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="c1"># Do nothing if there are no non-output nodes.</span>
        <span class="n">available_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">output_keys</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">available_nodes</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="n">del_key</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">available_nodes</span><span class="p">)</span>

        <span class="n">connections_to_delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">del_key</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
                <span class="n">connections_to_delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">connections_to_delete</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">del_key</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">del_key</span></div>

<div class="viewcode-block" id="DefaultGenome.mutate_delete_connection"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.mutate_delete_connection">[docs]</a>    <span class="k">def</span> <span class="nf">mutate_delete_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="DefaultGenome.distance"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.distance">[docs]</a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the genetic distance between this genome and the other. This distance value</span>
<span class="sd">        is used to compute genome compatibility for speciation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Compute node gene distance component.</span>
        <span class="n">node_distance</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">disjoint_nodes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="n">iterkeys</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="n">disjoint_nodes</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">disjoint_nodes</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Homologous genes compute their own distance value.</span>
                    <span class="n">node_distance</span> <span class="o">+=</span> <span class="n">n1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

            <span class="n">max_nodes</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>
            <span class="n">node_distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">node_distance</span> <span class="o">+</span>
                             <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">compatibility_disjoint_coefficient</span> <span class="o">*</span>
                              <span class="n">disjoint_nodes</span><span class="p">))</span> <span class="o">/</span> <span class="n">max_nodes</span>

        <span class="c1"># Compute connection gene differences.</span>
        <span class="n">connection_distance</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
            <span class="n">disjoint_connections</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="n">iterkeys</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">connections</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
                    <span class="n">disjoint_connections</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">c1</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">):</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">c2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">disjoint_connections</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Homologous genes compute their own distance value.</span>
                    <span class="n">connection_distance</span> <span class="o">+=</span> <span class="n">c1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

            <span class="n">max_conn</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">connections</span><span class="p">))</span>
            <span class="n">connection_distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">connection_distance</span> <span class="o">+</span>
                                   <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">compatibility_disjoint_coefficient</span> <span class="o">*</span>
                                    <span class="n">disjoint_connections</span><span class="p">))</span> <span class="o">/</span> <span class="n">max_conn</span>

        <span class="n">distance</span> <span class="o">=</span> <span class="n">node_distance</span> <span class="o">+</span> <span class="n">connection_distance</span>
        <span class="k">return</span> <span class="n">distance</span></div>

<div class="viewcode-block" id="DefaultGenome.size"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.size">[docs]</a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns genome &#39;complexity&#39;, taken to be</span>
<span class="sd">        (number of nodes, number of enabled connections)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_enabled_connections</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">cg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">cg</span><span class="o">.</span><span class="n">enabled</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="n">num_enabled_connections</span></div>

<div class="viewcode-block" id="DefaultGenome.__str__"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Nodes:&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">ng</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">ng</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Connections:&quot;</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">connections</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="DefaultGenome.create_node"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.create_node">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_node</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">node_id</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">node_gene_type</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">init_attributes</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span></div>

<div class="viewcode-block" id="DefaultGenome.create_connection"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.create_connection">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">):</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">connection_gene_type</span><span class="p">((</span><span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">init_attributes</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="DefaultGenome.connect_fs_neat_nohidden"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.connect_fs_neat_nohidden">[docs]</a>    <span class="k">def</span> <span class="nf">connect_fs_neat_nohidden</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomly connect one input to all output nodes</span>
<span class="sd">        (FS-NEAT without connections to hidden, if any).</span>
<span class="sd">        Originally connect_fs_neat.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_id</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">input_keys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">output_keys</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="DefaultGenome.connect_fs_neat_hidden"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.connect_fs_neat_hidden">[docs]</a>    <span class="k">def</span> <span class="nf">connect_fs_neat_hidden</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomly connect one input to all hidden and output nodes</span>
<span class="sd">        (FS-NEAT with connections to hidden, if any).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input_id</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">input_keys</span><span class="p">)</span>
        <span class="n">others</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">input_keys</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">others</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="DefaultGenome.compute_full_connections"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.compute_full_connections">[docs]</a>    <span class="k">def</span> <span class="nf">compute_full_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">direct</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute connections for a fully-connected feed-forward genome--each</span>
<span class="sd">        input connected to all hidden nodes</span>
<span class="sd">        (and output nodes if ``direct`` is set or there are no hidden nodes),</span>
<span class="sd">        each hidden node connected to all output nodes.</span>
<span class="sd">        (Recurrent genomes will also include node self-connections.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hidden</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">output_keys</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">output_keys</span><span class="p">]</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">hidden</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">input_id</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">input_keys</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
                    <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">input_id</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                    <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">output_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">direct</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">hidden</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">input_id</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">input_keys</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                    <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">))</span>

        <span class="c1"># For recurrent genomes, include node self-connections.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">feed_forward</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
                <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">connections</span></div>


<div class="viewcode-block" id="DefaultGenome.connect_full_nodirect"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.connect_full_nodirect">[docs]</a>    <span class="k">def</span> <span class="nf">connect_full_nodirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a fully-connected genome</span>
<span class="sd">        (except without direct input-output unless no hidden nodes).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_full_connections</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="DefaultGenome.connect_full_direct"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.connect_full_direct">[docs]</a>    <span class="k">def</span> <span class="nf">connect_full_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a fully-connected genome, including direct input-output connections.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_full_connections</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="DefaultGenome.connect_partial_nodirect"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.connect_partial_nodirect">[docs]</a>    <span class="k">def</span> <span class="nf">connect_partial_nodirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a partially-connected genome,</span>
<span class="sd">        with (unless no hidden nodes) no direct input-output connections.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">config</span><span class="o">.</span><span class="n">connection_fraction</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="n">all_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_full_connections</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">all_connections</span><span class="p">)</span>
        <span class="n">num_to_add</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_connections</span><span class="p">)</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">connection_fraction</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">all_connections</span><span class="p">[:</span><span class="n">num_to_add</span><span class="p">]:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="DefaultGenome.connect_partial_direct"><a class="viewcode-back" href="../module_summaries.html#genome.DefaultGenome.connect_partial_direct">[docs]</a>    <span class="k">def</span> <span class="nf">connect_partial_direct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a partially-connected genome,</span>
<span class="sd">        including (possibly) direct input-output connections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">config</span><span class="o">.</span><span class="n">connection_fraction</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="n">all_connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_full_connections</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">all_connections</span><span class="p">)</span>
        <span class="n">num_to_add</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_connections</span><span class="p">)</span> <span class="o">*</span> <span class="n">config</span><span class="o">.</span><span class="n">connection_fraction</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span> <span class="ow">in</span> <span class="n">all_connections</span><span class="p">[:</span><span class="n">num_to_add</span><span class="p">]:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">input_id</span><span class="p">,</span> <span class="n">output_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">connection</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015-2017, CodeReclaimers, LLC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>